<section class="day">

  <header class="date-header" [ngClass]="{'current-day': isToday}">
    <h2>{{dayName}}</h2>
    <h3>{{daySubtitle}}</h3>
    <div class="tasks-actions">
      <button mat-stroked-button (click)="promptAddTask()">Add Task</button>
    </div>
  </header>

  <mat-spinner *ngIf="loading | async; else tasksList"></mat-spinner>

  <ng-template #tasksList>

    <div class="add-task-card">
      <mat-card [hidden]="!(addingTask$ | async)">
        <mat-form-field class="add-task-field">
          <mat-label></mat-label>
          <input type="text" #addTaskInput autocomplete="off" placeholder="Enter task title" matInput
            [formControl]="newTaskControl" (keyup.enter)="leavePromptAddTask()" (blur)="leavePromptAddTask()"
            (keyup.esc)="cancelPromptAddTask()">
        </mat-form-field>
      </mat-card>
    </div>

    <div id="{{dayUrl}}" class="tasks" sortablejs [sortablejsOptions]="options">

      <mat-card *ngFor="let task of tasks" class="mat-elevation-z2" matRipple (click)="openEditTakDialog(task)"
        [ngClass]="{'task-complete': task.complete}">
        <span class="task-title">{{task.title}}</span>
      </mat-card>
    </div>

    <mat-expansion-panel class="habits-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Habits
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ul class="habits-list">
        <li class="habit" *ngFor="let habit of (habitsDetails$ | async)" [ngStyle]="{'color': habit.colour}">
          <mat-checkbox [checked]="habit.entry !== undefined" (change)="toggleHabit(habit.id, habit.entry)"
            color="primary">
            <span>{{habit.title}}</span></mat-checkbox>
        </li>
      </ul>
    </mat-expansion-panel>

  </ng-template>

</section>